<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Explore Catalog - Library</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/catalog.css' %}">
</head>
<body>
  <header>
    <h1>Explore Our Catalog</h1>
  </header>

  <div class="container">
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Search by title or author...">
    </div>

    <div class="book-grid" id="bookGrid">
      {% for book in books %}
      <div class="book" data-book-id="{{ book.id }}"
           onclick="openPopup('{{ book.id }}', '{{ book.title }}', '{{ book.author }}', '{{ book.description }}')">
        <div class="book-title">{{ book.title }}</div>
        <div class="book-author">{{ book.author }}</div>

        {% if book.id in borrowed_book_ids %}
          <form method="POST" action="{% url 'return_book' book.id %}" onclick="event.stopPropagation();">
            {% csrf_token %}
            <button type="submit" class="borrow-btn">Return</button>
          </form>
        {% else %}
          {% if book.stock.available_copies > 0 %}
            <button class="borrow-btn" onclick="event.stopPropagation(); openPopup('{{ book.id }}', '{{ book.title }}', '{{ book.author }}', '{{ book.description }}')">Borrow</button>
          {% else %}
            <button class="borrow-btn" disabled style="background-color: grey;" onclick="event.stopPropagation();">Out of Stock</button>
          {% endif %}
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <a href="{% url 'home' %}" class="back-link">&larr; Back to Home</a>
  </div>

  <!-- Popup Modal -->
  <div id="popup" class="popup" style="display:none;">
    <div class="popup-content">
      <span class="close-btn" onclick="closePopup()">&times;</span>
      <h2 id="popupTitle"></h2>
      <p><strong>Author:</strong> <span id="popupAuthor"></span></p>
      <p><strong>Description:</strong> <span id="popupDescription"></span></p>
      <form method="POST" id="borrowForm">
        {% csrf_token %}
        <button type="submit" class="borrow-btn">Borrow Now</button>
      </form>
    </div>
  </div>

  <script src="{% static 'js/catalog.js' %}"></script>
</body>
</html>
